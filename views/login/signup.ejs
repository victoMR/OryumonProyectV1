<%- include("../header/index")%>
<%- include("../menu/menuLogin")%>

<div class="container mt-5">
  <form action="/usuarios/usuarios/nuevousuario" method="post" enctype="multipart/form-data">
    <div class="progress">
      <div class="progress-bar progress-bar-original" role="progressbar" style="width: 25%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
    </div>

    <!-- Fase 1: Nombre Completo, CURP, RFC -->
    <div class="phase" id="phase1">
      <div class="card">
        <div class="card-header">
          <h3>Fase 1</h3>
        </div>
        <div class="card-body">
          <div class="p-0 m-2">Nombre Completo</div>
          <input class="form-control mb-3" type="text" name="nombreCompleto" id="nombreCompleto" placeholder="Nombre Completo" required />

          <div class="p-0 m-2">CURP</div>
          <input class="form-control mb-3" type="text" name="curp" id="curp" placeholder="CURP" required />

          <div class="p-0 m-2">RFC</div>
          <input class="form-control mb-3" type="text" name="rfc" id="rfc" placeholder="RFC" required />
        </div>
      </div>
    </div>

    <!-- Fase 2: Correo, Teléfono, Nombre de la Empresa -->
    <div class="phase" id="phase2" style="display: none;">
      <div class "card">
        <div class="card-header">
          <h3>Fase 2</h3>
        </div>
        <div class="card-body">
          <div class="p-0 m-2">Correo Electrónico</div>
          <input class="form-control mb-3" type="email" name="correo" id="correo" placeholder="Correo Electrónico" required />

          <div class="p-0 m-2">Teléfono</div>
          <input class="form-control mb-3" type="tel" name="telefono" id="telefono" placeholder="Teléfono" required />

          <div class="p-0 m-2">Nombre de la Empresa</div>
          <input class="form-control mb-3" type="text" name="nombreEmpresa" id="nombreEmpresa" placeholder="Nombre de la Empresa" />
        </div>
      </div>
    </div>

    <!-- Fase 3: RFC de la Empresa (opcional), Usuario, Contraseña -->
    <div class="phase" id="phase3" style="display: none;">
      <div class="card">
        <div class="card-header">
          <h3>Fase 3</h3>
        </div>
        <div class="card-body">
          <div class="p-0 m-2">RFC de la Empresa (opcional)</div>
          <input class="form-control mb-3" type="text" name="rfcEmpresa" id="rfcEmpresa" placeholder="RFC de la Empresa" />

          <div class="p-0 m-2">Usuario</div>
          <input class="form-control mb-3" type="text" name="usuario" id="usuario" placeholder="Usuario" required />

          <div class="p-0 m-2">Contraseña</div>
          <input class="form-control mb-3" type="password" name="password" id="password" placeholder="Contraseña" required />
          <div class="password-validation mt-2">
            <ul>
              <li id="length">Mínimo 8 caracteres</li>
              <li id="special">Al menos 1 carácter especial</li>
              <li id="number">Al menos 2 números</li>
              <li id="unique">Sin caracteres repetidos</li>
            </ul>
          </div>
          <div class="password-strength mt-2">
            <div class="progress">
              <div class="progress-bar2" role="progressbar" style="width: 0;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Fase 4: Foto de Perfil, Foto de Documento -->
    <div class="phase" id="phase4" style="display: none;">
      <div class="card">
        <div class="card-header">
          <h3>Fase 4</h3>
        </div>
        <div class="card-body">
          <div class="p-0 m-2">Foto de Perfil</div>
          <input class="form-control mb-3" type="file" name="fotoPerfil" id="fotoPerfil" required />

          <div class="p-0 m-2">Foto de Documento (INE o Pasaporte)</div>
          <input class="form-control mb-3" type="file" name="fotoDocumento" id="fotoDocumento" required />
        </div>
      </div>
    </div>

    <!-- Banner de validación -->
    <div class="alert alert-success mt-3" id="validationBanner" style="display: none;">
      ¡El formulario se ha completado exitosamente!
    </div>

    <div class="card-footer">
      <div class="d-flex justify-content-between">
        <button class="btn btn-primary" id="prevButton" style="display: none;">Anterior</button>
        <button class="btn btn-primary" id="nextButton" style="margin-top: 20px;">Continuar</button>
        <button class="btn btn-success" type="submit" style="display: none;">Finalizar</button>
      </div>
    </div>
  </form>
</div>

<!-- Estilos CSS -->
<style>
  .progress {
    margin-bottom: 20px;
  }

  .card {
    margin-top: 20px;
  }

  .progress-bar2 {
    background-color: red; /* Color de fondo inicial de la barra de progreso */
  }
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/zxcvbn/4.4.2/zxcvbn.js"></script>
<script>
  $(document).ready(function () {
    let currentPhase = 1;
    const phases = 4;

    function showPhase(phase) {
      for (let i = 1; i <= phases; i++) {
        if (i === phase) {
          $(`#phase${i}`).show();
        } else {
          $(`#phase${i}`).hide();
        }
      }
    }

    $("#nextButton").click(function () {
      if (currentPhase < phases) {
        if (validatePhase(currentPhase)) {
          currentPhase++;
          showPhase(currentPhase);
          if (currentPhase === phases) {
            $("#prevButton").show();
            $("#nextButton").hide();
            $("button[type=submit]").show().text("Finalizar");
            $("#validationBanner").show();
          }
        }
        updateProgressBar();
      }
    });

    $("#prevButton").click(function () {
      if (currentPhase > 1) {
        currentPhase--;
        showPhase(currentPhase);
        updateProgressBar();
        if (currentPhase < phases) {
          $("#prevButton").show();
          $("#nextButton").show();
          $("button[type=submit]").hide();
          $("#validationBanner").hide();
        }
      }
    });

    // Función para validar si una fase está completa
    function validatePhase(phase) {
      let isValid = true;
      if (phase === 1) {
        if ($("#nombreCompleto").val() === "" || $("#curp").val() === "" || $("#rfc").val() === "") {
          isValid = false;
        }
      } else if (phase === 2) {
        if ($("#correo").val() === "" || $("#telefono").val() === "") {
          isValid = false;
        }
      } else if (phase === 3) {
        if ($("#usuario").val() === "" || $("#password").val() === "") {
          isValid = false;
        }
      }
      return isValid;
    }

    function updateProgressBar() {
      const progress = (currentPhase / phases) * 100;
      $(".progress-bar-original").css("width", `${progress}%`);
      $(".progress-bar-original").attr("aria-valuenow", progress);
    }

    showPhase(currentPhase);
    updateProgressBar();
  });
</script>
<%- include("../footer/footer")%>